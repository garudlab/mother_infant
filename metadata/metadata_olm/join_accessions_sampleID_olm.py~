# April 21, 2020
# this code will join the sample accessions with the sample IDs for Olm et al. 


# Read in NIH1 metadata
NIH1=open('NIH1_accesssions_IDs_PRJNA294605_tsv.txt')
NIH1_header=NIH1.readline()

EBI_dict={}

for line in NIH1:
    items=line.strip().split('\t')
    accession=items[5]
    id=items[8]
    EBI_dict[id]=accession

NIH2=open('NIH2_run_PRJNA376566_tsv.txt')  
NIH2_header=NIH2.readline() 

for line in NIH2:
    items=line.strip().split('\t')
    accession=items[4]
    id=items[7]
    EBI_dict[id]=accession

# read in metadata for NIH3 from paper supp needed for joining
NIH3_paper=open('NIH3_test.txt')
for line in NIH3_paper:
    items=line.strip().split('\t')
    infant_sample=items[0]
    dol=items[1]
    study_code=items[2].split('_')[0]
    new_id='N3_' + study_code + '_0' + dol + 'G1'
    print infant_sample + '\t' + new_id

NIH3=open('NIH3_PRJNA273761_tsv_match_with_supp_from_paper.txt')
NIH3_header=NIH3.readline()
for line in NIH3:
    items=line.strip().split('\t') 
    accession=items[3]
    id=items[9]
    #print accession + '\t' + id


# olm data


olm_data=open('Olm2019_Table_S1.csv')

olm_header=olm_data.readline().strip().split(',') # header

olm_dict={}
id_order=[]
for line in olm_data:
    items=line.strip().split(',')
    id=items[0]
    dol=int(items[2])
    #if dol !=0: # don't include day 0 because these are just aggregates of other days. 
    olm_dict[id] = items
    id_order.append(id)

    #iterate through each campgain to find the corresponding accession:
    if id in EBI_dict:
        accession = EBI_dict[id]
        olm_dict[id].append(accession)


outFile=open('olm_accessions_babyIds.txt','w')

outFile.write('\t'.join(olm_header) + 'accession' + '\n')
for id in id_order:
    outFile.write('\t'.join(olm_dict[id]) + '\n')        

outFile.close()
